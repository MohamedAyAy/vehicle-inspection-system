- User Interface Service :
	- the main interface communication between system and user (could be customer, or technician or admin)
	- the user will be asked to log in to his acc, so when he specifies credentials or decides to make new acc, the UI lets Auth Service to handle it.
	- if the user is a customer, he will be directed to page with 2 options, appointment, or results (including reports, progress) check
then if he wants to appoint, he gotta give his vehicule infos (car, moto, matricule, type, etc...), if he wants to see progress, it is simple
	- if the user is a technician, he will be directed to the appointements he has , and choose a vehicule and see his progress in inspection, and have
the informations to fill up,then he can send the inspection results viathe interface to inspection service
	- if the user is a moderator/supervisor, he will be able to check all database, appointements, technician , logging system, etc..
- Authorization Service:
	- when the user creates new account, he will provide valid email, the service will send verification email
	- then auth service logs that to logging service
	- once acc created, it will be as customer and credentials will be saved to Accounts DB
	- the auth will generate next time a token to allow the user to do all requests without the need to login again
	- Auth service will put that in logs
- Appointment Service:
	- Head of appointments management
	- Access to database to add/remove/edit an appointement
	- Logs that in
	- Will receive confirmation from payment, then confirm the appointement, send to DB and to UI for user to see
- Payment Service :
	- User has to pay in advance to make sure he will attend the apointment after making an appointment
	- The payment service will log that, and will save his payment as valid and confirmed in DataBase
	- Then it will send information to Appointment Service, which will therefore send info to UI Service.
- Inspection Service :
	- The user that gives it information about inspection results, is actually the technician.
	- First it sends the informations that technician must fill, it sends it to UI, then technician fills some or all, and send it back
	- The service logs it (sends to logging service) and stores the information in the database "Inspection Results"
	- The inspection service can know if the user is technician or not, through decrypting the token, and see if "modmodmodmod" term is among it.
- Logging Service : 
	- It receives events from all services, and logs them into the Logs DataBase
	- Allows access to moderator/admin from UI, to read the logs from DataBase
	- It can know if the user is mod/admin or not, through decrypting the token and see if "adminadminadminadmin" term is among it.

Note :
- The way that a service knows if user is allowed to use it or not, can change and handle that to UI service (you can consider it as main server), or
get response from Auth Service if user is allowed or not, you can simply send token of user (that contains email/username and password encrypted) to Auth service
so that last tells the service if it can do its job for the user.



------- more details ----------



üìò Technical Specification ‚Äî Vehicle Inspection Center Management System
üß± OVERVIEW

The system is a distributed full-stack web application composed of six microservices:

User Interface Service (UI)

Authorization Service (Auth)

Appointment Management Service

Payment Service

Inspection Service

Logging Service

Each service runs independently, exposes REST APIs, and stores its own data in PostgreSQL (each with a dedicated database).

Communication between services occurs via:

HTTP requests using JSON.

Internal service-to-service calls (e.g., Appointment ‚Üí Payment).

Logs always sent to the Logging Service.

‚öôÔ∏è TECHNOLOGY STACK
| Layer          | Recommended Technology                      |
| -------------- | ------------------------------------------- |
| Frontend       | HTML/CSS + JavaScript (Vanilla or React.js) |
| Backend        | FastAPI (Python) or Node.js + Express       |
| Database       | PostgreSQL                                  |
| Authentication | JWT tokens (generated by Auth Service)      |
| Format         | JSON for all data exchange                  |
| Logs           | Stored in PostgreSQL (Logging DB)           |
| Communication  | REST over HTTP (port-based microservices)   |

üß© 1. USER INTERFACE SERVICE
Purpose

The User Interface Service (UI) is the bridge between users and backend services.
It manages the entire user experience and acts as the ‚Äúmain server‚Äù that orchestrates requests to other microservices.

Roles Supported

Customer: Can register, login, book appointments, pay, and view inspection results.

Technician: Can log in, see assigned appointments, record inspection results.

Moderator/Admin: Can access logs, monitor appointments, payments, and inspections.

Typical Workflow

User opens UI ‚Üí Login/Register form appears.

On login: credentials sent to Auth Service.

On success: Auth returns JWT token stored locally.

UI uses JWT token for all further requests to other services.

Depending on role:

Customer: sees Appointment and Results options.

Technician: sees Assigned Vehicles and Submit Results options.

Admin: can access logs, users, payments overview, etc.

Example UI Paths
| Route           | Description                  |
| --------------- | ---------------------------- |
| `/login`        | Login form for all users     |
| `/register`     | New user registration        |
| `/appointments` | Create and view appointments |
| `/inspection`   | Technician dashboard         |
| `/admin`        | Moderator access to logs     |

Backend Communication
| Service             | Action                                      |
| ------------------- | ------------------------------------------- |
| Auth Service        | Validate credentials, register new accounts |
| Appointment Service | Book appointments, list them                |
| Payment Service     | Confirm payments                            |
| Inspection Service  | Fetch technician data, submit results       |
| Logging Service     | Display logs to admin                       |

Common Implementation Errors (Avoid These)

‚ùå Forgetting to include JWT in Authorization header ‚Üí backend will reject requests.

‚ùå Not handling 401 errors ‚Üí user stays stuck on expired session.

‚ùå Sending data in wrong format (should always be JSON, not form-urlencoded).

‚ùå Cross-Origin (CORS) errors when calling backend from local HTML (add CORS middleware in FastAPI).

Example Fix (FastAPI CORS):
from fastapi.middleware.cors import CORSMiddleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"]
)

üîê 2. AUTHORIZATION SERVICE
Purpose

Manages:

Registration

Login

Email verification

Token generation (JWT)

Role management (customer, technician, admin)

Main Endpoints
| Method | Route         | Description                                      |
| ------ | ------------- | ------------------------------------------------ |
| `POST` | `/register`   | Create account, store credentials in Accounts DB |
| `POST` | `/login`      | Validate credentials, issue JWT                  |
| `POST` | `/verify`     | Confirm email (optional feature)                 |
| `GET`  | `/public_key` | Provide public key to verify tokens              |

Database (Accounts DB)
| Column          | Type      | Description                   |
| --------------- | --------- | ----------------------------- |
| `id`            | UUID      | User ID                       |
| `email`         | VARCHAR   | Unique email                  |
| `password_hash` | VARCHAR   | Hashed password               |
| `role`          | VARCHAR   | customer / technician / admin |
| `created_at`    | TIMESTAMP | Registration date             |

Notes for Implementation

Use bcrypt to hash passwords.

Store hashed passwords, never plaintext.

On successful login ‚Üí issue JWT with payload:
{
  "email": "user@example.com",
  "role": "customer",
  "exp": 3600
}

Common Errors

‚ùå Using plaintext passwords ‚Üí security risk.

‚ùå Storing tokens in frontend localStorage permanently ‚Üí use in-memory or sessionStorage.

‚ùå Missing token expiration ‚Üí users stay logged forever.
üìÖ 3. APPOINTMENT MANAGEMENT SERVICE
Purpose

Handles all appointment creation, editing, and cancellation.
Also listens for payment confirmation from the Payment Service.

Endpoints
| Method   | Route                        | Description                                        |
| -------- | ---------------------------- | -------------------------------------------------- |
| `POST`   | `/appointments`              | Create a new appointment (status: pending payment) |
| `GET`    | `/appointments/{user_id}`    | Retrieve appointments for a user                   |
| `PUT`    | `/appointments/{id}/confirm` | Mark appointment as confirmed after payment        |
| `DELETE` | `/appointments/{id}`         | Cancel appointment                                 |

Database (Appointments DB)
| Column         | Type      | Description                      |
| -------------- | --------- | -------------------------------- |
| `id`           | UUID      | Appointment ID                   |
| `user_id`      | UUID      | User reference                   |
| `vehicle_info` | JSON      | Vehicle type, registration, etc. |
| `status`       | VARCHAR   | pending, confirmed, cancelled    |
| `payment_id`   | UUID      | Payment reference                |
| `created_at`   | TIMESTAMP | Creation time                    |

Workflow

Customer requests new appointment via UI.

Appointment Service stores it in DB (status = pending).

Triggers Payment Service request.

Once payment confirmed ‚Üí updates status to ‚Äúconfirmed‚Äù.

Sends update to UI and logs action in Logging Service.

Common Errors

‚ùå Forgetting to update appointment status after payment.

‚ùå Not checking payment ID existence.

‚ùå Duplicate appointments (solve by using Idempotency-Key in headers).

üí≥ 4. PAYMENT SERVICE
Purpose

Processes prepayments to confirm user appointments.

Endpoints
| Method | Route                  | Description                                 |
| ------ | ---------------------- | ------------------------------------------- |
| `POST` | `/payment`             | Initiate payment for a specific appointment |
| `POST` | `/payment/confirm`     | Called when payment validated               |
| `GET`  | `/payment/status/{id}` | Check payment status                        |

Database (Payments DB)
| Column           | Type                                 |
| ---------------- | ------------------------------------ |
| `id`             | UUID                                 |
| `appointment_id` | UUID                                 |
| `user_id`        | UUID                                 |
| `amount`         | FLOAT                                |
| `status`         | VARCHAR (pending, confirmed, failed) |
| `created_at`     | TIMESTAMP                            |

Workflow

Appointment Service requests payment creation.

User completes payment (mock for dev, real API later).

Payment Service sets status = ‚Äúconfirmed‚Äù.

Sends callback to Appointment Service ‚Üí appointment confirmed.

Common Errors

‚ùå Payment not linked correctly to appointment ‚Üí orphaned records.

‚ùå Appointment confirmation missing ‚Üí user can‚Äôt see ‚Äúconfirmed‚Äù status.

‚ùå Forgetting to log successful payments to Logging Service.

üß∞ 5. INSPECTION SERVICE
Purpose

Used by technicians to record inspection results of vehicles.

Endpoints
| Method | Route                                   | Description                |
| ------ | --------------------------------------- | -------------------------- |
| `GET`  | `/inspections/assigned/{technician_id}` | Get all assigned vehicles  |
| `POST` | `/inspections/submit`                   | Submit inspection data     |
| `GET`  | `/inspections/result/{appointment_id}`  | Retrieve inspection report |

Database (Inspection Results DB)


| Column           | Type      | Description           |
| ---------------- | --------- | --------------------- |
| `id`             | UUID      | Inspection ID         |
| `appointment_id` | UUID      | Linked appointment    |
| `technician_id`  | UUID      | Technician            |
| `results`        | JSON      | Items checked, status |
| `final_status`   | VARCHAR   | PASS / FAIL           |
| `created_at`     | TIMESTAMP | Date/time             |

Workflow

Technician logs in ‚Üí JWT role checked.

Technician fetches appointments.

Fills form (brakes, lights, etc.) and submits results.

Inspection Service stores results ‚Üí logs event ‚Üí notifies UI.

Common Mistakes

‚ùå Accepting requests without verifying technician token.

‚ùå Forgetting to link inspection with appointment.

‚ùå Storing large JSON blobs (split into smaller fields or documents).

ü™µ 6. LOGGING SERVICE
Purpose

Centralized service for collecting logs from all microservices.

Endpoints
| Method | Route      | Description                       |
| ------ | ---------- | --------------------------------- |
| `POST` | `/log`     | Receive logs (info, error, debug) |
| `GET`  | `/log/all` | Admin access to read logs         |

Database (Logs DB)
| Column      | Type      |
| ----------- | --------- |
| `id`        | UUID      |
| `service`   | VARCHAR   |
| `event`     | VARCHAR   |
| `level`     | VARCHAR   |
| `message`   | TEXT      |
| `timestamp` | TIMESTAMP |

Example Log Entry
{
  "service": "PaymentService",
  "event": "payment.confirmed",
  "level": "INFO",
  "message": "Payment for appointment 1923 confirmed by user 43A",
  "timestamp": "2025-10-12T10:22:00Z"
}

Common Errors

‚ùå Logging too late (after error handling ‚Üí loses context).

‚ùå Logging sensitive data (passwords, tokens).

‚ùå UI trying to access logs without checking admin privileges.

üîë TOKEN VALIDATION AND PERMISSIONS

Tokens generated by Auth Service.

Each service validates JWT before processing request.

To verify admin/technician:

Decrypt token and look for keywords:

"modmodmodmod" ‚Üí moderator/admin

"techtechtechtech" ‚Üí technician

Alternative: include roles directly in token payload.

üß† SYSTEM FLOW EXAMPLES
Customer Booking Flow

Customer logs in via UI ‚Üí gets JWT.

UI calls /appointments ‚Üí creates record.

Appointment Service requests Payment Service.

User pays ‚Üí Payment confirms ‚Üí Appointment updates.

UI updates to show ‚ÄúAppointment Confirmed‚Äù.

Technician Inspection Flow

Technician logs in (role: technician).

UI shows /inspections/assigned/{id}.

Technician fills form and submits ‚Üí Inspection Service logs results.

Admin Logging Flow

Admin logs in.

UI requests /log/all.

Logging Service validates admin role and returns all logs.

‚öôÔ∏è BACKEND PORTS (recommended)
| Service     | Port |
| ----------- | ---- |
| UI          | 3000 |
| Auth        | 8001 |
| Appointment | 8002 |
| Payment     | 8003 |
| Inspection  | 8004 |
| Logging     | 8005 |

üß© FRONTEND STRUCTURE
frontend/
‚îÇ‚îÄ‚îÄ index.html
‚îÇ‚îÄ‚îÄ login.html
‚îÇ‚îÄ‚îÄ register.html
‚îÇ‚îÄ‚îÄ customer-dashboard.html
‚îÇ‚îÄ‚îÄ technician-dashboard.html
‚îÇ‚îÄ‚îÄ admin-dashboard.html
‚îÇ‚îÄ‚îÄ js/
‚îÇ   ‚îî‚îÄ‚îÄ api.js (handles all fetch() calls)
‚îÇ‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ style.css

